{% extends "_layout.twig" %}
{% from 'components/wikilinks.twig' import wikilinks %}

{% set title = "Edit article" %}
{% set noindex = true %}

	{% block content %}
<h1>Edit article</h1>

<form action="/wiki/edit.php?page={{ pagetitle_slugified }}" method="POST">
	<p><strong>{{ pagetitle }}</strong></p>
	<p><textarea name="text" placeholder="Page content" cols="100" rows="20" {% if not log %}disabled{% endif %}>{{ page.content }}</textarea></p>

	{% if log %}
		{% if page.minedit <= userdata.powerlevel %}
			<p><em>Markdown formatting syntax is allowed.</em></p>

			<p><input type="text" name="description" placeholder="Description (Describe what has been changed)" size="60"></p>
			<p>
				<input type="submit" name="action" value="Save changes"></input>
				<input type="submit" name="action" value="Preview"></input>
			</p>

			{% if userdata.powerlevel > 2 %}
				<p>Minimum powerlevel to edit:
					<select name="minedit">
						{% for plid, plname in powerlevels %}
							<option value="{{ plid }}"{% if plid == page.minedit %} selected{% endif %}>{{ plname }}</option>
						{% endfor %}
					</select>
				</p>
			{% endif %}

			<p>By submitting changes you agree to license them under the CC-BY 4.0 license. <a href="/wiki/Copyright">Read more</a></p>
		{% else %}
			{% if userdata.powerlevel > 0 %}
				<p>This page is locked and cannot be edited by unprivileged users.</p>
			{% else %}
				<p>You have been banned and cannot edit the wiki.</p>
			{% endif %}
		{% endif %}
	{% else %}
		<p>Please <a href="/login">log in</a> to make edits to this page.</p>
	{% endif %}
</form>

{% if action == 'Preview' %}
	<hr>

	<h1>Preview: {{ pagetitle }}</h1>
	{{ page.content | markdown_wiki }}
{% endif %}

{{ wikilinks(pagetitle_slugified, "edit") }}
	{% endblock %}